5 REM DESCRIPTION: ELIZA - A classic chatbot simulation
6 REM CATEGORY: AI & Machine Learning
7 REM SOURCE: https://www.atariarchives.org/bcc3/showpage.php?page=251
8 REM COMMENT: Adapted by JGalego from Jeff North's ELIZA

# include "input.bas"
# include "string.bas"

10 REM
20 REM     -----INITIALIZATION-----
30 REM
40 DIM ConjugatedStr AS STRING
50 DIM InputStr AS STRING
60 DIM KeywordStr AS STRING
70 DIM FormatStr AS STRING
80 DIM SwapStr AS STRING
90 DIM ReplacementStr AS STRING
100 DIM PreviousStr AS STRING
110 DIM DummyStr AS STRING
120 DIM StartPos(36) AS UBYTE
130 DIM ReplyCounter(36) AS UBYTE
140 DIM EndPos(36) AS UBYTE
150 DIM i AS UBYTE
160 DIM j AS UBYTE
170 DIM k AS UBYTE
180 REM
190 DIM NumKeywords AS UBYTE
200 DIM NumSwaps AS UBYTE
210 DIM NumReplies AS UBYTE
220 DIM KeywordNum AS UBYTE
230 DIM MatchPos AS UBYTE
240 NumKeywords = 36
250 NumSwaps = 12
260 NumReplies = 112
270 FOR i = 1 TO NumKeywords + NumSwaps + NumReplies
280     READ DummyStr
290 NEXT i
300 FOR i = 1 TO NumKeywords
310     READ StartPos(i), j
320     ReplyCounter(i) = StartPos(i)
330     EndPos(i) = StartPos(i) + j - 1
340 NEXT i
350 PRINT: PRINT INK 2; "ELIZA: HI! I'M ELIZA. WHAT'S YOUR PROBLEM?": PRINT
360 REM
370 REM     -----USER INPUT SECTION-----
380 REM
390 InputStr = INPUT(72)
400 LET InputStr = " " + InputStr + "  "
410 REM  GET RID OF APOSTROPHES
420 FOR i = 0 TO LEN(InputStr)-1
430     IF InputStr(i) = "'" THEN
440         InputStr = LEFT$(InputStr, i) + RIGHT$(InputStr, LEN(InputStr) - i - 1)
450         GOTO 430
460     END IF
470     REM Convert to uppercase
480     IF InputStr(i) >= "a" AND InputStr(i) <= "z" THEN
490         InputStr(i) = CHR$(CODE(InputStr(i)) - 32)
500     END IF
510 NEXT i
520 PRINT INK 1; "USER:"; InputStr
530 IF InputStr = PreviousStr THEN
540     PRINT: PRINT INK 2; "ELIZA: PLEASE DON'T REPEAT YOURSELF!"
550     GOTO 360
560 END IF
570 REM
580 REM     -----FIND KEYWORDS IN INPUT-----
590 REM
600 PRINT: PRINT INK 3; "SEARCHING FOR KEYWORDS..."
610 RESTORE
620 KeywordNum = 0
630 FOR k = 1 TO NumKeywords
640     READ KeywordStr
650     IF KeywordNum > 0 THEN GOTO 710
660     FOR i = 1 TO LEN(InputStr) - LEN(KeywordStr) + 1
670         IF MID$(InputStr, i, LEN(KeywordStr)) = KeywordStr THEN
680             KeywordNum = k
690             MatchPos = i
700             FormatStr = KeywordStr
710         END IF
720     NEXT i
730 NEXT k
740 IF KeywordNum > 0 THEN
750     k = KeywordNum
760     i = MatchPos
770     GOTO 810
780 END IF
790 k = 36
800 GOTO 1120
810 REM
820 REM     TAKE RIGHT PART OF STRING AND CONJUGATE IT
830 REM     USING THE LIST OF STRINGS TO BE SWAPPED
840 REM
850 PRINT: PRINT INK 3; "CONJUGATING THE INPUT..."
860 RESTORE
870 FOR j = 1 TO NumKeywords
880     READ DummyStr
890 NEXT j
900 ConjugatedStr = " " + RIGHT$(InputStr, LEN(InputStr) - LEN(FormatStr) - i - 1)
910 FOR j = 1 TO NumSwaps / 2
920     READ SwapStr, ReplacementStr
930     FOR i = 1 TO LEN(ConjugatedStr)
940         IF i + LEN(SwapStr) > LEN(ConjugatedStr) THEN GOTO 990
950         IF MID$(ConjugatedStr, i, LEN(SwapStr)) <> SwapStr THEN GOTO 990
960         ConjugatedStr = LEFT$(ConjugatedStr, i - 1) + ReplacementStr + RIGHT$(ConjugatedStr, LEN(ConjugatedStr) - i - LEN(SwapStr) + 1)
970         i = i + LEN(ReplacementStr)
980         GOTO 1040
990         IF i + LEN(ReplacementStr) > LEN(ConjugatedStr) THEN GOTO 1040
1000         IF MID$(ConjugatedStr, i, LEN(ReplacementStr)) <> ReplacementStr THEN GOTO 1040
1010         ConjugatedStr = LEFT$(ConjugatedStr, i - 1) + SwapStr + RIGHT$(ConjugatedStr, LEN(ConjugatedStr) - i - LEN(ReplacementStr) + 1)
1020         i = i + LEN(SwapStr)
1030     NEXT i
1040 NEXT j
1050 IF MID$(ConjugatedStr, 2, 1) = " " THEN
1060     ConjugatedStr = RIGHT$(ConjugatedStr, LEN(ConjugatedStr) - 1)
1070 END IF
1080 REM
1090 REM     NOW USING THE KEYWORD NUMBER (KeywordNum) GET REPLY
1100 REM
1110 PRINT: PRINT INK 3; "SELECTING A REPLY..."
1120 RESTORE
1130 FOR j = 1 TO NumKeywords + NumSwaps
1140     READ DummyStr
1150 NEXT j
1160 FOR j = 1 TO ReplyCounter(k)
1170     READ FormatStr
1180 NEXT j
1190 ReplyCounter(k) = ReplyCounter(k) + 1
1200 IF ReplyCounter(k) > EndPos(k) THEN
1210     ReplyCounter(k) = StartPos(k)
1220 END IF
1230 IF RIGHT$(FormatStr, 1) <> "*" THEN
1240     PRINT: PRINT INK 2; "ELIZA: "; FormatStr: PRINT
1250     PreviousStr = InputStr
1260     GOTO 360
1270 END IF
1280 PRINT: PRINT INK 2; "ELIZA: "; LEFT$(FormatStr, LEN(FormatStr) - 1); ConjugatedStr: PRINT
1290 PreviousStr = InputStr
1300 GOTO 360
9000 REM
9010 REM     -----PROGRAM DATA FOLLOWS-----
9020 REM
9030 REM     KEYWORDS
9040 REM
9050 DATA "CAN YOU","CAN I","YOU ARE","YOURE","I DONT","I FEEL"
9060 DATA "WHY DONT YOU","WHY CANT I","ARE YOU","I CANT","I AM","IM "
9070 DATA "YOU ","I WANT","WHAT","HOW","WHO","WHERE","WHEN","WHY"
9080 DATA "NAME","CAUSE","SORRY","DREAM","HELLO","HI ","MAYBE"
9090 DATA " NO","YOUR","ALWAYS","THINK","ALIKE","YES","FRIEND"
9100 DATA "COMPUTER","NOKEYFOUND"
9110 REM
9120 REM     STRING DATA FOR CONJUGATIONS
9130 REM
9140 DATA " ARE "," AM ","WERE ","WAS "," YOU "," I ","YOUR ","MY "
9150 DATA " IVE "," YOUVE "," IM "," YOURE "
9160 REM
9170 REM     REPLIES
9180 REM
9190 DATA "DON'T YOU BELIEVE THAT I CAN*"
9200 DATA "PERHAPS YOU WOULD LIKE TO BE ABLE TO*"
9210 DATA "YOU WANT ME TO BE ABLE TO*"
9220 DATA "PERHAPS YOU DON'T WANT TO*"
9230 DATA "DO YOU WANT TO BE ABLE TO*"
9240 DATA "WHAT MAKES YOU THINK I AM*"
9250 DATA "DOES IT PLEASE YOU TO BELIEVE I AM*"
9260 DATA "PERHAPS YOU WOULD LIKE TO BE*"
9270 DATA "DO YOU SOMETIMES WISH YOU WERE*"
9280 DATA "DON'T YOU REALLY*"
9290 DATA "WHY DON'T YOU*"
9300 DATA "DO YOU WISH TO BE ABLE TO*"
9310 DATA "DOES THAT TROUBLE YOU?"
9320 DATA "TELL ME MORE ABOUT SUCH FEELINGS."
9330 DATA "DO YOU OFTEN FEEL*"
9340 DATA "DO YOU ENJOY FEELING*"
9350 DATA "DO YOU REALLY BELIEVE I DON'T*"
9360 DATA "PERHAPS IN GOOD TIME I WILL*"
9370 DATA "DO YOU WANT ME TO*"
9380 DATA "DO YOU THINK YOU SHOULD BE ABLE TO*"
9390 DATA "WHY CAN'T YOU*"
9400 DATA "WHY ARE YOU INTERESTED IN WHETHER OR NOT I AM*"
9410 DATA "WOULD YOU PREFER IF I WERE NOT*"
9420 DATA "PERHAPS IN YOUR FANTASIES I AM*"
9430 DATA "HOW DO YOU KNOW YOU CAN'T*"
9440 DATA "HAVE YOU TRIED?"
9450 DATA "PERHAPS YOU CAN NOW*"
9460 DATA "DID YOU COME TO ME BECAUSE YOU ARE*"
9470 DATA "HOW LONG HAVE YOU BEEN*"
9480 DATA "DO YOU BELIEVE IT IS NORMAL TO BE*"
9490 DATA "DO YOU ENJOY BEING*"
9500 DATA "WE WERE DISCUSSING YOU-- NOT ME."
9510 DATA "OH, I*"
9520 DATA "YOU'RE NOT REALLY TALKING ABOUT ME, ARE YOU?"
9530 DATA "WHAT WOULD IT MEAN TO YOU IF YOU GOT*"
9540 DATA "WHY DO YOU WANT*"
9550 DATA "SUPPOSE YOU SOON GOT*"
9560 DATA "WHAT IF YOU NEVER GOT*"
9570 DATA "I SOMETIMES ALSO WANT*"
9580 DATA "WHY DO YOU ASK?"
9590 DATA "DOES THAT QUESTION INTEREST YOU?"
9600 DATA "WHAT ANSWER WOULD PLEASE YOU THE MOST?"
9610 DATA "WHAT DO YOU THINK?"
9620 DATA "ARE SUCH QUESTIONS ON YOUR MIND OFTEN?"
9630 DATA "WHAT IS IT THAT YOU REALLY WANT TO KNOW?"
9640 DATA "HAVE YOU ASKED ANYONE ELSE?"
9650 DATA "HAVE YOU ASKED SUCH QUESTIONS BEFORE?"
9660 DATA "WHAT ELSE COMES TO MIND WHEN YOU ASK THAT?"
9670 DATA "NAMES DON'T INTEREST ME."
9680 DATA "I DON'T CARE ABOUT NAMES-- PLEASE GO ON."
9690 DATA "IS THAT THE REAL REASON?"
9700 DATA "DON'T ANY OTHER REASONS COME TO MIND?"
9710 DATA "DOES THAT REASON EXPLAIN ANYTHING ELSE?"
9720 DATA "WHAT OTHER REASONS MIGHT THERE BE?"
9730 DATA "PLEASE DON'T APOLOGIZE!"
9740 DATA "APOLOGIES ARE NOT NECESSARY."
9750 DATA "WHAT FEELINGS DO YOU HAVE WHEN YOU APOLOGIZE."
9760 DATA "DON'T BE SO DEFENSIVE!"
9770 DATA "WHAT DOES THAT DREAM SUGGEST TO YOU?"
9780 DATA "DO YOU DREAM OFTEN?"
9790 DATA "WHAT PERSONS APPEAR IN YOUR DREAMS?"
9800 DATA "ARE YOU DISTURBED BY YOUR DREAMS?"
9810 DATA "HOW DO YOU DO ... PLEASE STATE YOUR PROBLEM."
9820 DATA "YOU DON'T SEEM QUITE CERTAIN."
9830 DATA "WHY THE UNCERTAIN TONE?"
9840 DATA "CAN'T YOU BE MORE POSITIVE?"
9850 DATA "YOU AREN'T SURE?"
9860 DATA "DON'T YOU KNOW?"
9870 DATA "ARE YOU SAYING NO JUST TO BE NEGATIVE?"
9880 DATA "YOU ARE BEING A BIT NEGATIVE."
9890 DATA "WHY NOT?"
9900 DATA "ARE YOU SURE?"
9910 DATA "WHY NO?"
9920 DATA "WHY ARE YOU CONCERNED ABOUT MY*"
9930 DATA "WHAT ABOUT YOUR OWN*"
9940 DATA "CAN YOU THINK OF A SPECIFIC EXAMPLE?"
9950 DATA "WHEN?"
9960 DATA "WHAT ARE YOU THINKING OF?"
9970 DATA "REALLY, ALWAYS?"
9980 DATA "DO YOU REALLY THINK SO?"
9990 DATA "BUT YOU ARE NOT SURE YOU*"
10000 DATA "DO YOU DOUBT YOU*"
10010 DATA "IN WHAT WAY?"
10020 DATA "WHAT RESEMBLANCE DO YOU SEE?"
10030 DATA "WHAT DOES THE SIMILARITY SUGGEST TO YOU?"
10040 DATA "WHAT OTHER CONNECTIONS DO YOU SEE?"
10050 DATA "COULD THERE REALLY BE SOME CONNECTION?"
10060 DATA "HOW?"
10070 DATA "YOU SEEM QUITE POSITIVE."
10080 DATA "ARE YOU SURE?"
10090 DATA "I SEE."
10100 DATA "I UNDERSTAND."
10110 DATA "WHY DO YOU BRING UP THE TOPIC OF FRIENDS?"
10120 DATA "DO YOUR FRIENDS WORRY YOU?"
10130 DATA "DO YOUR FRIENDS PICK ON YOU?"
10140 DATA "ARE YOU SURE YOU HAVE ANY FRIENDS?"
10150 DATA "DO YOU IMPOSE ON YOUR FRIENDS?"
10160 DATA "PERHAPS YOUR LOVE FOR FRIENDS WORRIES YOU."
10170 DATA "DO COMPUTERS WORRY YOU?"
10180 DATA "ARE YOU TALKING ABOUT ME IN PARTICULAR?"
10190 DATA "ARE YOU FRIGHTENED BY MACHINES?"
10200 DATA "WHY DO YOU MENTION COMPUTERS?"
10210 DATA "WHAT DO YOU THINK MACHINES HAVE TO DO WITH YOUR PROBLEM?"
10220 DATA "DON'T YOU THINK COMPUTERS CAN HELP PEOPLE?"
10230 DATA "WHAT IS IT ABOUT MACHINES THAT WORRIES YOU?"
10240 DATA "SAY, DO YOU HAVE ANY PSYCHOLOGICAL PROBLEMS?"
10250 DATA "WHAT DOES THAT SUGGEST TO YOU?"
10260 DATA "I SEE."
10270 DATA "I'M NOT SURE I UNDERSTAND YOU FULLY."
10280 DATA "COME COME ELUCIDATE YOUR THOUGHTS."
10290 DATA "CAN YOU ELABORATE ON THAT?"
10300 DATA "THAT IS QUITE INTERESTING."
10310 REM
10320 REM     DATA FOR FINDING RIGHT REPLIES
10330 REM
10340 DATA 1,3,4,2,6,4,6,4,10,4,14,3,17,3,20,2,22,3,25,3
10350 DATA 28,4,28,4,32,3,35,5,40,9,40,9,40,9,40,9,40,9,40,9
10360 DATA 49,2,51,4,55,4,59,4,63,1,63,1,64,5,69,5,74,2,76,4
10370 DATA 80,3,83,7,90,3,93,6,99,7,106,6